/*
 * Selecter Plugin [Formtone Library]
 * @author Ben Plum
 * @version 2.2.8
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
if(jQuery){(function(l){var s=0,n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,q=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test((navigator.userAgent||navigator.vendor||window.opera));var e={callback:l.noop,cover:false,customClass:"",defaultLabel:false,externalLinks:false,links:false,trimOptions:false};var t={defaults:function(x){e=l.extend(e,x||{});return l(this)},disable:function(x){return l(this).each(function(A,y){var B=l(y).next(".selecter").data("selecter");if(typeof x!="undefined"){var z=B.$items.index(B.$items.filter("[data-value="+x+"]"));B.$items.eq(z).addClass("disabled");B.$options.eq(z).prop("disabled",true)}else{if(B.$selecter.hasClass("open")){B.$selecter.find(".selecter-selected").trigger("click")}B.$selecter.addClass("disabled");B.$select.prop("disabled",true)}})},enable:function(x){return l(this).each(function(A,y){var B=l(y).next(".selecter").data("selecter");if(typeof x!="undefined"){var z=B.$items.index(B.$items.filter("[data-value="+x+"]"));B.$items.eq(z).removeClass("disabled");B.$options.eq(z).prop("disabled",false)}else{B.$selecter.removeClass("disabled");B.$select.prop("disabled",false)}})},destroy:function(){return l(this).each(function(z,y){var A=l(y),x=A.next(".selecter");if(x.hasClass("open")){x.find(".selecter-selected").trigger("click")}if(l.fn.scroller!=undefined){x.find(".selecter-options").scroller("destroy")}A.off(".selecter").removeClass("selecter-element").show();x.off(".selecter").remove()})}};function p(z){z=l.extend({},e,z||{});var A=l(this);for(var x=0,y=A.length;x<y;x++){g(A.eq(x),z)}return A}function g(z,x){if(!z.hasClass("selecter-element")){x=l.extend({},x,z.data("selecter-options"));if(x.externalLinks){x.links=true}var y=z.find("option, optgroup"),E=y.filter("option"),G=E.filter(":selected"),F=(x.defaultLabel)?-1:E.index(G),A=(x.links)?"nav":"div";x.multiple=z.prop("multiple");x.disabled=z.is(":disabled");var D="<"+A+' class="selecter'+x.customClass;if(q){D+=" mobile"}else{if(x.cover){D+=" cover"}}if(x.multiple){D+=" multiple"}else{D+=" closed"}if(x.disabled){D+=" disabled"}D+='">';if(!x.multiple){D+='<span class="selecter-selected icon-select">';D+=l("<span></span").text(m(x.trimOptions,((x.defaultLabel!=false)?x.defaultLabel:G.text()))).html();D+="</span>"}D+='<div class="selecter-wrapper"><dl class="selecter-options">';D+="</dl></div>";D+="</"+A+">";z.addClass("selecter-element").after(D);var C=z.next(".selecter"),B=l.extend({$select:z,$allOptions:y,$options:E,$selecter:C,$selected:C.find(".selecter-selected"),$wrapper:C.find(".selecter-wrapper"),$selectOptions:C.find(".selecter-options"),index:F,guid:s++},x);k(B);if(l.fn.scroller!=undefined){B.$wrapper.scroller()}B.$selecter.on("click.selecter",".selecter-selected",B,h).on("click.selecter",".selecter-item",B,a).on("selecter-close",B,d).data("selecter",B);if((!B.links&&!q)||q){B.$select.on("change",B,v).on("blur.selecter",B,o);if(!q){B.$select.on("focus.selecter",B,f)}}else{B.$select.hide()}}}function k(D){var z="",C=(D.links)?"a":"dd",x=0;for(var y=0,B=D.$allOptions.length;y<B;y++){var E=D.$allOptions.eq(y);if(E[0].tagName=="OPTGROUP"){z+='<dt class="selecter-group';if(E.is(":disabled")){z+=" disabled"}z+='">'+E.attr("label")+"</dt>"}else{var A=E.val();if(!E.attr("value")){E.attr("value",A)}z+="<"+C+' class="selecter-item';if(E.is(":selected")&&!D.defaultLabel){z+=" selected"}if(E.is(":disabled")){z+=" disabled"}z+='" ';if(D.links){z+='href="'+A+'"'}else{z+='data-value="'+A+'"'}z+="><i>"+l("<span></span>").text(m(D.trimOptions,E.text())).html()+"</i></"+C+">";x++}}D.$selectOptions.html(z);D.$items=D.$selecter.find(".selecter-item")}function h(A){A.preventDefault();A.stopPropagation();var z=A.data;if(!z.$select.is(":disabled")){l(".selecter").not(z.$selecter).trigger("selecter-close",[z]);if(q){var y=z.$select[0];if(document.createEvent){var x=document.createEvent("MouseEvents");x.initMouseEvent("mousedown",true,true,window,0,0,0,0,0,false,false,false,false,0,null);y.dispatchEvent(x)}else{if(element.fireEvent){y.fireEvent("onmousedown")}}}else{if(z.$selecter.hasClass("closed")){c(A)}else{if(z.$selecter.hasClass("open")){d(A)}}}}}function c(A){A.preventDefault();A.stopPropagation();var z=A.data;if(!z.$selecter.hasClass("open")){var x=z.$selecter.offset(),C=l("body").outerHeight(),y=z.$wrapper.outerHeight(true);if(x.top+y>C){z.$selecter.addClass("bottom")}z.$wrapper.show();z.$selecter.removeClass("closed").addClass("open");l("body").on("click.selecter-"+z.guid,":not(.selecter-options)",z,w);var B=(z.index>=0)?z.$items.eq(z.index).position():{left:0,top:0};if(l.fn.scroller!=undefined){z.$wrapper.scroller("scroll",(z.$wrapper.find(".scroller-content").scrollTop()+B.top),0).scroller("reset")}else{z.$wrapper.scrollTop(z.$wrapper.scrollTop()+B.top)}}}function d(y){y.preventDefault();y.stopPropagation();var x=y.data;if(x.$selecter.hasClass("open")){x.$wrapper.hide();x.$selecter.removeClass("open").addClass("closed");l("body").off(".selecter-"+x.guid)}}function w(x){x.preventDefault();x.stopPropagation();if(l(x.currentTarget).parents(".selecter").length==0){d(x)}}function a(A){A.preventDefault();A.stopPropagation();var x=l(this),z=A.data;if(!z.$select.is(":disabled")){if(z.$wrapper.is(":visible")){var y=z.$items.index(x);u(y,z,false)}if(!z.multiple){d(A)}}}function v(B,y){if(!y){var x=l(this),A=B.data;if(A.links){if(q){j(x.val(),A.externalLinks)}else{j(x.attr("href"),A.externalLinks)}}else{if(!A.multiple){var z=A.$options.index(A.$options.filter("[value='"+b(x.val())+"']"));u(z,A,false)}}}}function f(y){y.preventDefault();y.stopPropagation();var x=y.data;if(!x.$select.is(":disabled")&&!x.multiple){x.$selecter.addClass("focus");l(".selecter").not(x.$selecter).trigger("selecter-close",[x]);l("body").on("keydown.selecter-"+x.guid,x,r)}}function o(y){y.preventDefault();y.stopPropagation();var x=y.data;x.$selecter.removeClass("focus");l(".selecter").not(x.$selecter).trigger("selecter-close",[x]);l("body").off(".selecter-"+x.guid)}function r(C){var B=C.data;if(B.$selecter.hasClass("open")&&C.keyCode==13){u(B.index,B,false);d(C)}else{if(C.keyCode!=9&&(!C.metaKey&&!C.altKey&&!C.ctrlKey&&!C.shiftKey)){C.preventDefault();C.stopPropagation();var A=B.$items.length-1,y=-1;if(l.inArray(C.keyCode,(n)?[38,40,37,39]:[38,40])>-1){y=B.index+((C.keyCode==38||(n&&C.keyCode==37))?-1:1);if(y<0){y=0}if(y>A){y=A}}else{var x=String.fromCharCode(C.keyCode).toUpperCase();for(i=B.index+1;i<=A;i++){var z=B.$options.eq(i).text().charAt(0).toUpperCase();if(z==x){y=i;break}}if(y<0){for(i=0;i<=A;i++){var z=B.$options.eq(i).text().charAt(0).toUpperCase();if(z==x){y=i;break}}}}if(y>=0){u(y,B,true)}}}}function u(B,D,z){var y=D.$items.eq(B),A=y.hasClass("selected"),x=y.hasClass("disabled");if(!x){if(!A||D.links){var C=y.html(),E=y.data("value");if(D.multiple){D.$options.eq(B).prop("selected",true)}else{D.$selected.html(C);D.$items.filter(".selected").removeClass("selected");D.$select[0].selectedIndex=B;if(D.links&&!z){if(q){j(D.$select.val(),D.externalLinks)}else{j(y.attr("href"),D.externalLinks)}return}}D.$select.trigger("change",[true]);y.addClass("selected")}else{if(D.multiple){D.$options.eq(B).prop("selected",null);y.removeClass("selected")}}if(!A||D.multiple){D.callback.call(D.$selecter,D.$select.val(),B);D.index=B}}}function m(x,y){if(x===false){return y}else{if(y.length>x){return y.substring(0,x)+"..."}else{return y}}}function j(x,y){if(y){window.open(x)}else{window.location.href=x}}function b(x){return x.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1")}l.fn.selecter=function(x){if(t[x]){return t[x].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof x==="object"||!x){return p.apply(this,arguments)}}return this}})(jQuery)};
